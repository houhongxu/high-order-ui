"use strict";var I=Object.create;var p=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var U=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var B=(a,t)=>{for(var e in t)p(a,e,{get:t[e],enumerable:!0})},y=(a,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of E(t))!k.call(a,o)&&o!==e&&p(a,o,{get:()=>t[o],enumerable:!(r=z(t,o))||r.enumerable});return a};var N=(a,t,e)=>(e=a!=null?I(U(a)):{},y(t||!a||!a.__esModule?p(e,"default",{value:a,enumerable:!0}):e,a)),R=a=>y(p({},"__esModule",{value:!0}),a);var q={};B(q,{default:()=>Q});module.exports=R(q);var V=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"];var M=(a,t)=>{var e="";for(let r=1;r<=t;r++){let o=Math.floor(a)/Math.pow(83,t-r)%83;e+=V[Math.floor(o)]}return e},d=a=>{let t=a/255;return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},g=a=>{let t=Math.max(0,Math.min(1,a));return t<=.0031308?Math.trunc(t*12.92*255+.5):Math.trunc((1.055*Math.pow(t,.4166666666666667)-.055)*255+.5)},W=a=>a<0?-1:1,w=(a,t)=>W(a)*Math.pow(Math.abs(a),t),x=class extends Error{constructor(a){super(a),this.name="ValidationError",this.message=a}};var P=4,F=(a,t,e,r)=>{let o=0,h=0,i=0,u=t*P;for(let l=0;l<t;l++){let c=P*l;for(let s=0;s<e;s++){let f=c+s*u,m=r(l,s);o+=m*d(a[f]),h+=m*d(a[f+1]),i+=m*d(a[f+2])}}let n=1/(t*e);return[o*n,h*n,i*n]},T=a=>{let t=g(a[0]),e=g(a[1]),r=g(a[2]);return(t<<16)+(e<<8)+r},j=(a,t)=>{let e=Math.floor(Math.max(0,Math.min(18,Math.floor(w(a[0]/t,.5)*9+9.5)))),r=Math.floor(Math.max(0,Math.min(18,Math.floor(w(a[1]/t,.5)*9+9.5)))),o=Math.floor(Math.max(0,Math.min(18,Math.floor(w(a[2]/t,.5)*9+9.5))));return e*19*19+r*19+o},H=(a,t,e,r,o)=>{if(r<1||r>9||o<1||o>9)throw new x("BlurHash must have between 1 and 9 components");if(t*e*4!==a.length)throw new x("Width and height must match the pixels array");let h=[];for(let s=0;s<o;s++)for(let f=0;f<r;f++){let m=f==0&&s==0?1:2,O=F(a,t,e,(C,$)=>m*Math.cos(Math.PI*f*C/t)*Math.cos(Math.PI*s*$/e));h.push(O)}let i=h[0],u=h.slice(1),n="",l=r-1+(o-1)*9;n+=M(l,1);let c;if(u.length>0){let s=Math.max(...u.map(m=>Math.max(...m))),f=Math.floor(Math.max(0,Math.min(82,Math.floor(s*166-.5))));c=(f+1)/166,n+=M(f,1)}else c=1,n+=M(0,1);return n+=M(T(i),4),u.forEach(s=>{n+=M(j(s,c),2)}),n},D=H;var A=N(require("sharp")),v="ImageOptimizerWebpackPlugin",L=async a=>{let t=(0,A.default)(a).raw().ensureAlpha(),{width:e=0,height:r=0}=await t.metadata(),{data:o,info:h}=await t.resize({width:16}).toBuffer({resolveWithObject:!0}),i=new Uint8Array(o.buffer),u=new Uint8ClampedArray(i.buffer),n=D(u,h.width,h.height,4,4);return{width:e,height:r,blurhash:encodeURIComponent(n)}},b=class{filename;constructor(t){this.filename=t?.filename}apply(t){t.hooks.thisCompilation.tap(v,e=>{e.hooks.finishModules.tapPromise(v,async()=>{let r={},o=Array.from(e.modules).map(async h=>{if(h.type==="asset/resource"){let i=h.libIdent({context:t.options.context||""});if(i){let u=await L(i);r[i]=u}}});await Promise.all(o),t.options.output.assetModuleFilename=h=>{let{width:i,height:u,blurhash:n}=r[`./${h.filename}`],l;return this.filename?typeof this.filename=="function"?l=this.filename(h):l=this.filename:l="[hash][ext]",`${l.split("?")[0]}?width=${i}&height=${u}&blurhash=${n}`}})})}},Q=b;
